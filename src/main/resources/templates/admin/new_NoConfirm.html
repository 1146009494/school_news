<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="include/admin/adminHeader::html('管理员')"></head>

<style>
    div.container div.row div {
        margin: 5px 0px;
    }

    div.container div.row div {
        background-color: lightgray;
        border: 1px solid gray;
        text-align: center;
    }
</style>

<script type="text/javascript">
    $(function () {
        Vue.filter('dateformat', function(dataStr) {
            return moment(dataStr).format('YYYY-MM-DD HH:mm:ss')
        })
        /*文档加载开始*/
        var data4Vue = {
            uri: "new",
            pagination: {},
            beans: [],
            bean: {
                id: 0, user_write: {id:0,realname: ""}, refer_time: "", note_type: {id: 0}, note_title: "", note: ""
                , image_url: "", video_url: "", user_read: {realname: ""}, auditor_time: "", state: "未审核"
            },
            keyword: "",
            is_search: "",
            video_url:""
        };

        //ViewModel
        var vue = new Vue({
            el: '#workingArea',
            data: data4Vue,
            mounted: function () { //mounted　表示这个 Vue 对象加载成功了
                this.list(0);
                this.getUser();
            },
            methods: {
                /*获取审核人信息*/
                getUser:function () {
                  this.bean.user_read.id=[[${session.user.id}]];
                },
                list: function (start) {
                    var url = this.uri + "bystate/" + this.bean.state + "?start=" + start;
//                    如果是条件查询就访问这个请求
                    if (this.is_search) {
                        url = this.uri + "_search/" + this.bean.state + "?keyword=" + this.keyword + "&start=" + start;
                    }

                    axios.get(url).then(function (response) {
                        vue.pagination = response.data.data;
                        vue.beans = response.data.data.content;
                        console.log(vue.beans);
                    });
                },
                confirm: function (id) {
                    if (!confirm("确认审核通过"))
                        return;
                    var url = this.uri + "/" + id + "/审核通过/"+this.bean.user_read.id;
                    axios.put(url).then(function (response) {
                        vue.list(0);
                    })
                },
                refuse: function (id) {
                    if (!confirm("确认审核不通过"))
                        return;
                    var url = this.uri + "/" + id + "/审核不通过/"+this.bean.user_read.id;
                    axios.put(url).then(function (response) {
                        vue.list(0);
                    })
                },
                getVideoUrl:function (video_url) {
                    this.video_url=video_url;
                },
                search: function () {
                    this.is_search = true;
                    var url = this.uri + "_search/" + this.bean.state + "?keyword=" + this.keyword;
                    alert(url);
                    axios.get(url).then(function (response) {
                        vue.pagination = response.data.data;
                        vue.beans = response.data.data.content;
                    })
                },
                all: function () {
                    this.is_search = false;
                    this.list(0);
                },
                jump: function (page) {
                    jump(page, vue); //定义在adminHeader.html 中
                },
                jumpByNumber: function (start) {
                    jumpByNumber(start, vue);
                }

            }
        });

        /*文档加载借宿*/
    });


</script>

<body>
<div>
    <div id="workingArea">
        <div class="container">
            <div class="row">
                <!--栅栏布局12列开始-->
                <div class="col-xs-12"><p>欢迎进入校园管理系统后台</p></div>

                <!--栅栏布局3列-->
                <div th:replace="include/admin/adminLeftMenu::html"></div>

                <!--栅栏布局9列开始-->
                <div class="col-xs-9 ">
                    <!--搜索框开始-->
                    <!--<div class="container">-->
                    <div class="input-group">
                        <input type="text" v-model="keyword" class="form-control input-md">
                        <span @click="search" class="input-group-addon btn btn-primary">搜索</span>
                        <span @click="all" class="input-group-addon btn btn-primary" th:text="显示全部"></span>
                    </div>
                    <!--</div>-->
                    <!--搜索框结束-->

                    <!--查询结果显示开始-->
                    <div>
                        <span class="text-muted">未审核列表</span>
                        <table class="table table-striped table-bordered table-hover  table-condensed">
                            <thead>
                            <tr class="success">
                                <th>ID</th>
                                <th>作者</th>
                                <th>提交时间</th>
                                <th>文章标题</th>
                                <th>文章内容</th>
                                <th>文章类型</th>
                                <th>相关图片</th>
                                <th>相关视频</th>
                                <th>通过</th>
                                <th>不通过</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr v-for=" bean in beans">
                                <td>{{bean.id}}</td>
                                <td>{{bean.user_write.realname}}</td>
                                <td>{{bean.refer_time|dateformat}}</td>
                                <td>{{bean.note_title}}</td>
                                <td>{{bean.note}}</td>
                                <td>{{bean.note_type.name}}</td>
                                <td v-if="null!=bean.image_url"><img height="50px" :src="'img/news/'+bean.image_url"></td>
                                <td v-else>无</td>
                                <td v-if="null!=bean.video_url">
                                    <a href="#nowhere" @click="getVideoUrl(bean.video_url)" data-toggle="modal" data-target="#myModal">
                                        <span class="glyphicon glyphicon-list"></span></a>
                                </td>
                                <td v-else>无</td>
                                <td><a href="#nowhere" @click="confirm(bean.id)">
                                    <span class="glyphicon glyphicon-ok"></span></a></td>
                                <td><a href="#nowhere" @click="refuse(bean.id)">
                                    <span class="glyphicon glyphicon-remove"></span></a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--查询结果显示结束-->

                    <!--分页显示-->
                    <div th:replace="include/admin/adminPage::html"></div>

                    <!--修改模态窗体-->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span
                                            class="sr-only">Close</span></button>
                                    <h4 class="modal-title">{{video_url}}</h4>
                                    <video height="600px" width="600px" :src="'video/news/'+video_url" controls preload="auto">
                                    </video>
                                </div>
                                <!--<div class="modal-body">-->
                                    <!--&lt;!&ndash;<p>编辑信息</p>&ndash;&gt;-->
                                    <!--<form>-->
                                        <!--用户名：<input v-model="bean_modify.name" name="name" class="form-control" placeholder="请输入用户名">-->
                                        <!--<br>-->
                                        <!--密&nbsp码：<input v-model="bean_modify.password" name="password" class="form-control"-->
                                                       <!--placeholder="请输入密码">-->
                                        <!--<br>-->
                                        <!--修改图片：<input type="file" @change="getFile($event)"/>-->
                                        <!--&lt;!&ndash;<div align="center"><a href="#" @click="" >更新</a></div>&ndash;&gt;-->

                                        <!--&lt;!&ndash;<input type="submit" @click="update" value="更新">&ndash;&gt;-->
                                    <!--</form>-->
                                <!--</div>-->
                                <!--<div class="modal-footer">-->
                                    <!--<button data-dismiss="modal" class="btn btn-default" type="button">关闭</button>-->
                                    <!--<button data-dismiss="modal" class="btn btn-primary" type="button" @click="update">提交修改</button>-->
                                <!--</div>-->
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div>

                </div>
                <!--栅栏布局9列结束-->
            </div>
        </div>
    </div>
</div>

</body>
</html>