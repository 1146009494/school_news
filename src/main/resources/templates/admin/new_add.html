<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head th:include="include/admin/adminHeader::html('管理员')"></head>
\

<style>
    div.container div.row div {
        margin: 5px 0px;

    }

    div.container div.row div {
        background-color: lightgray;
        border: 1px solid gray;
        text-align: center;
    }
</style>

<script>
    $(function () {
        /*文档加载开始*/
        var data4Vue = {
            uri: "new",
            bean: {
                id: 0, user_write: {id:0}, refer_time: "", note_type: {id: 0}, note_title: "", note: ""
                ,image_url: "", video_url: "", user_auditor: "",auditor_time:"", state: "未审核"
            },
            types: [],
            image: "",
            video: ""
        };

        //ViewModel
        var vue = new Vue({
            el: '#workingArea',
            data: data4Vue,
            mounted: function () { //mounted　表示这个 Vue 对象加载成功了
                this.getNewType();
                this.getUser();
            },
            methods: {
                getUser:function () {
//                    vue.bean.user_write=[[${session.user}]];
                    this.bean.user_write.id=parseInt([[${session.user.id}]]);
//                    alert(this.bean.user_write.id);
                },
                    getNewType: function () {
                        var url = "type";
                        axios.get(url).then(function (response) {
                            vue.types = response.data.data.content;
    //                        console.log(vue.types);
                        })
                    },
                add: function () {
                    console.log(this.bean);
                    var url = this.uri;
                    var formData = new FormData();

                    formData.append("user_write", this.bean.user_write.id);
//                    formData.append("refer_time", this.bean.refer_time);
                    formData.append("note_title", this.bean.note_title);
                    formData.append("note", this.bean.note);
                    formData.append("note_type", this.bean.note_type.id);
                    formData.append("user_auditor", this.bean.user_auditor);
//                    formData.append("auditor_time", this.bean.auditor_time);
                    formData.append("state", this.bean.state);
//                    formData.append("image", this.image);
//                    formData.append("video", this.video);
                    formData.append("files", this.image);
                    formData.append("files", this.video);
                    console.log(formData);
                    axios.post(url, formData, {headers: {'Content-Type': 'multipart/form-data'}})
                        .then(function (response) {
                        if (response.data.code != 0) {
                            alert("增加失败");
                        } else {
                            alert("增加成功");
                            this.bean = {id: "", name: "", password: "", realname: "", phone: "", role: ""};
                        }
                    });
                },
                getImage: function (event) {
                    this.image = event.target.files[0];
                },
                getVideo: function (event) {
                    this.video = event.target.files[0];
                }
            }
        });
    });
</script>

<body>
<div>
    <div id="workingArea">
        <div class="container">
            <div class="row">
                <!--栅栏布局12列开始-->
                <div class="col-xs-12"><p>欢迎进入校园管理系统后台</p></div>

                <!--栅栏布局3列-->
                <div th:replace="include/admin/adminLeftMenu::html"></div>

                <!--栅栏布局9列开始-->
                <div class="col-xs-9 ">
                    <div>
                        <form style="width: 500px;margin: auto">
                            <table>
                                <tr>
                                    <td>文章标题：</td>
                                    <td><input v-model="bean.note_title"></td>
                                </tr>
                                <tr>
                                    <td>文章内容：</td>
                                    <td><input v-model="bean.note"></td>
                                </tr>
                                <tr>
                                    <td>
                                        文章类型：
                                    </td>
                                    <td>
                                        <select v-model="bean.note_type">
                                            <option v-for="type in types" v-bind:value="type">
                                                {{type.name}}
                                            </option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td>图片上传 ：</td>
                                    <td><input id="image" type="file" @change="getImage($event)"></td>
                                </tr>
                                <tr>
                                    <td>视频上传 ：</td>
                                    <td><input id="video" type="file" @change="getVideo($event)"></td>
                                </tr>


                                <!--<tr>-->
                                <!--<td>文章类型：</td>-->
                                <!--<td><select v-model="bean.role">-->
                                <!--<option>管理员</option>-->
                                <!--<option>新闻投稿员</option>-->
                                <!--<option>新闻审核员</option>-->
                                <!--</select>-->
                                <!--</td>-->
                                <!--</tr>-->
                                <tr>
                                    <td colspan="2" align="center">
                                        <button class="btn btn-primary" type="button" @click="add">增加</button>
                                    </td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
                <!--栅栏布局9列结束-->
            </div>
        </div>
    </div>
</div>

</body>
</html>